{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>IQF ‚Äì √Årea Fr√≠o</title>

    <link rel="stylesheet"
          href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">

    <style>
        body {
            background: linear-gradient(120deg, #4B3EDB 60%, #2E25A0 40%);
            min-height: 100vh;
            font-family: "Poppins", sans-serif;
            padding: 40px;
        }

        .container-box {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 10px 25px rgba(0,0,0,.25);
        }

        .badge-iqf { background:#0dcaf0; }
        .badge-ret { background:#dc3545; }
        .badge-desp { background:#198754; }
    </style>
</head>

<body>

<div class="container container-box">

    <h2 class="fw-bold mb-4">‚ùÑÔ∏è IQF y Descarte ‚Äì √Årea Fr√≠o</h2>

    <!-- FILTROS -->
    <form method="GET" class="row g-3 mb-4">

        <div class="col-md-3">
            <input type="text"
                   name="buscar"
                   class="form-control"
                   placeholder="Buscar por ID"
                   value="{{ buscar }}">
        </div>

        <div class="col-md-3">
            <select name="estado" class="form-select">
                <option value="">Todos</option>
                <option value="EN_IQF" {% if estado_filtro == "EN_IQF" %}selected{% endif %}>En IQF</option>
                <option value="RETIRADO" {% if estado_filtro == "RETIRADO" %}selected{% endif %}>Retirado</option>
                <option value="DESPACHADO" {% if estado_filtro == "DESPACHADO" %}selected{% endif %}>Despachado</option>
            </select>
        </div>

        <div class="col-md-3">
            <select name="variedad" class="form-select">
                <option value="">Todas las variedades</option>
                {% for v in variedades %}
                    <option value="{{ v }}"
                        {% if variedad_filtro == v %}selected{% endif %}>
                        {{ v }}
                    </option>
                {% endfor %}
            </select>
        </div>

        <div class="col-md-3 d-flex gap-2">
            <button class="btn btn-primary w-100">Filtrar</button>
            <a href="{% url 'lista_iqf_frio' %}" class="btn btn-secondary w-100">Limpiar</a>
        </div>

        <div class="col-md-3">
            <input type="date" name="fecha_inicio"
                   class="form-control"
                   value="{{ request.GET.fecha_inicio }}">
        </div>

        <div class="col-md-3">
            <input type="date" name="fecha_fin"
                   class="form-control"
                   value="{{ request.GET.fecha_fin }}">
        </div>

    </form>

    <!-- TABLA -->
    <table class="table table-striped table-hover text-center align-middle">
        <thead class="table-dark">
            <tr>
                <th>ID</th>
                <th>Grupo</th>
                <th>Variedad</th>
                <th>Peso IQF</th>
                <th>Peso Descarte</th>
                <th>D√≠as</th>
                <th>Estado</th>
                <th>Acci√≥n</th>
            </tr>
        </thead>

        <tbody>
        {% for i in iqf %}
            <tr>
                <td>{{ i.id }}</td>
                <td>{{ i.grupo_proceso.id_grupo }}</td>
                <td>{{ i.variedad }}</td>
                <td>{{ i.peso_iqf }} kg</td>
                <td>{{ i.peso_descarte }} kg</td>
                <td>{{ i.dias_en_iqf }}</td>

                <td>
                    {% if i.estado == "EN_IQF" %}
                        <span class="badge badge-iqf">En IQF</span>
                    {% elif i.estado == "RETIRADO" %}
                        <span class="badge badge-ret">Retirado</span>
                    {% else %}
                        <span class="badge badge-desp">Despachado</span>
                    {% endif %}
                </td>

                <td>
                    {% if i.estado == "EN_IQF" %}
                        <a href="{% url 'despachar_iqf_frio' i.id %}"
                           class="btn btn-sm btn-success">
                           üöö Despachar
                        </a>
                    {% else %}
                        ‚Äî
                    {% endif %}
                </td>
            </tr>
        {% empty %}
            <tr>
                <td colspan="8" class="text-muted">No hay registros IQF</td>
            </tr>
        {% endfor %}
        </tbody>
    </table>

    <a href="{% url 'menu_frio' %}" class="btn btn-link mt-3">‚Üê Volver al men√∫ Fr√≠o</a>

</div>

</body>
</html>
