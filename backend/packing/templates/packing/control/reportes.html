<div class="panel fadeIn">

    <h2>üìä Reportes Generales</h2>

    <!-- FILTRO -->
    <form id="filtroFechas" method="GET" class="filtros">
        <div>
            <label>Desde:</label>
            <input type="date" name="fecha_inicio" value="{{ request.GET.fecha_inicio }}">
        </div>

        <div>
            <label>Hasta:</label>
            <input type="date" name="fecha_fin" value="{{ request.GET.fecha_fin }}">
        </div>

        <button class="btn-filtrar">Aplicar filtro</button>
    </form>

    <!-- RESUMEN -->
    <div class="cards">
        <div class="card">üì• Pallets recibidos: <b>{{ total_pallets }}</b></div>
        <div class="card">‚öôÔ∏è Procesados: <b>{{ total_procesados }}</b></div>
        <div class="card">üß∫ Grupos: <b>{{ total_grupos }}</b></div>
        <div class="card">üì¶ Terminados: <b>{{ total_terminados }}</b></div>
        <div class="card">‚ùÑÔ∏è Total IQF: <b>{{ total_iqf }} kg</b></div>
        <div class="card">üóëÔ∏è Descarte: <b>{{ total_descarte }} kg</b></div>
    </div>

    <hr>

    <h3>Calidad de pallets terminados</h3>

    <div class="graf-container">
        <canvas id="grafCalidad"
            data-labels='[
                {% for c in calidad_terminados %}
                    "{{ c.calidad }}",
                {% endfor %}
            ]'
            data-values='[
                {% for c in calidad_terminados %}
                    {{ c.total }},
                {% endfor %}
            ]'>
        </canvas>
    </div>

    <hr>

    <h3>Resumen por productor</h3>

    <table class="table">
        <thead>
            <tr>
                <th>Productor</th>
                <th>Total Pallets</th>
            </tr>
        </thead>
        <tbody>
            {% for item in pallets_por_productor %}
            <tr>
                <td>{{ item.productor__nombre }}</td>
                <td>{{ item.total }}</td>
            </tr>
            {% empty %}
            <tr>
                <td colspan="2" class="text-center text-muted py-3">Sin datos en este rango</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

</div>


<style>
.panel { padding: 25px; animation: fade .25s ease; }

@keyframes fade {
    from { opacity: 0; transform: translateY(8px); }
    to   { opacity: 1; transform: none; }
}

.filtros {
    display: flex;
    gap: 15px;
    align-items: flex-end;
    margin-bottom: 20px;
}

.filtros label {
    font-size: 14px;
    color: #333;
}

.filtros input {
    padding: 7px 10px;
    border-radius: 8px;
    border: 1px solid #bbb;
}

.btn-filtrar {
    padding: 8px 15px;
    background: #4b3edb;
    border: none;
    color: white;
    border-radius: 8px;
    cursor: pointer;
}
.btn-filtrar:hover { background: #372aac; }

.cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 15px;
}

.card {
    background: #f5f5ff;
    padding: 15px;
    border-radius: 12px;
    font-size: 16px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.graf-container {
    width: 100%;
    height: 300px;
}

.table {
    width: 100%;
    border-collapse: collapse;
    margin-top: 15px;
}
.table th, .table td {
    border: 1px solid #ddd;
    padding: 8px;
}
.table th { background: #e6e6ff; }
</style>
