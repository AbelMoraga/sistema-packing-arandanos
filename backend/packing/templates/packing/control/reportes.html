{% extends "packing/control/menu_control_base.html" %}

{% block activo_reportes %}active{% endblock %}

{% block content %}

<h2 class="mb-4">üìä Reportes Generales</h2>

<!-- ================== TARJETAS ================== -->
<div class="row mb-4 text-center">

    <div class="col-md-2">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Pallets recibidos</h6>
            <h3 class="fw-bold">{{ total_pallets }}</h3>
        </div>
    </div>

    <div class="col-md-2">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Procesados</h6>
            <h3 class="fw-bold">{{ total_procesados }}</h3>
        </div>
    </div>

    <div class="col-md-2">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Terminados</h6>
            <h3 class="fw-bold">{{ total_terminados }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Total IQF (kg)</h6>
            <h3 class="fw-bold">{{ total_iqf|floatformat:1 }}</h3>
        </div>
    </div>

    <div class="col-md-3">
        <div class="card p-3 shadow-sm">
            <h6 class="text-muted">Descarte (kg)</h6>
            <h3 class="fw-bold">{{ total_descarte|floatformat:1 }}</h3>
        </div>
    </div>

</div>

<hr>

<!-- ================== GR√ÅFICO ================== -->
<h4 class="mb-3">üì¶ Calidad de pallets terminados</h4>

<div class="d-flex justify-content-center my-4">
    <div style="max-width: 420px;">
        <canvas id="grafCalidad"></canvas>
    </div>
</div>

<hr>

<!-- ================== TABLA ================== -->
<h4 class="mb-3">üë®‚Äçüåæ Pallets por productor</h4>

<table class="table table-bordered table-striped">
    <thead class="table-light">
        <tr>
            <th>Productor</th>
            <th>Total pallets</th>
        </tr>
    </thead>
    <tbody>
        {% for p in pallets_por_productor %}
        <tr>
            <td>{{ p.productor__nombre }}</td>
            <td>{{ p.total }}</td>
        </tr>
        {% empty %}
        <tr>
            <td colspan="2" class="text-center text-muted">Sin datos</td>
        </tr>
        {% endfor %}
    </tbody>
</table>

<!-- ================== SCRIPT ================== -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
const ctx = document.getElementById("grafCalidad");

new Chart(ctx, {
    type: "doughnut",
    data: {
        labels: [
            {% for c in calidad_terminados %}
                "{{ c.calidad }}"{% if not forloop.last %},{% endif %}
            {% endfor %}
        ],
        datasets: [{
            data: [
                {% for c in calidad_terminados %}
                    {{ c.total }}{% if not forloop.last %},{% endif %}
                {% endfor %}
            ],
            backgroundColor: [
                "#0d6efd", // Excelente ‚Üí azul
                "#198754", // Buena ‚Üí verde
                "#ffc107", // Baja ‚Üí amarillo
                "#dc3545"  // Otra ‚Üí rojo
            ],
            borderWidth: 1
        }]
    },
    options: {
        responsive: true,
        plugins: {
            legend: {
                position: "bottom"
            }
        }
    }
});
</script>

{% endblock %}
